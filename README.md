# 需求文档：AI 驱动的动态业务流生成平台 (flowmind)

## 1. 项目概述

这是一个能够根据**用户语义意图**动态编排**业务逻辑流**并实时生成相应**交互 UI** 的系统。这套系统中有一系列以业务为维度划分「技能包」，每个技能包中包含一系列原子服务。每个原子服务并不是一项既定的业务，而是类似增、删、改、查、上传、下载等操作的API。原子服务可以被自由组合，形成一条条的业务流程。

比如生活中的“点外卖”场景，现有的软件服务的做法是用户选择餐厅→选择菜品→填地址→付款→送餐。而现在我们有比如「附近餐厅推荐」、「菜品口味筛选」、「地址校验」、「支付方式选择」等原子服务，AI可以根据用户的需求，动态拼接这些原子服务，形成一条条的业务流程。这其中，我们并不会通过任何方式向AI定义好业务流程，而是通过AI自己学习用户的需求，自己生成业务流程。

---

## 2. 执行流程

User Intent（由前端的 Chat Window 获取（暂时不做，由 Postman 执行调用接口进行测试））
   ↓
Planner LLM（初始化推理模型）
   ↓
Structured Plan（调用模型生成符合 DSL 中自定义协议的结构化计划）
   ↓
Human Approval（使用 Human in the Loop，把生成的结构化数据转化成用户可理解的语义化输入，并让用户确认。目前只做用户确认，不可以让用户自己修改）
   ↓
Executor（解析生成的计划，并寻找对应的原子服务依次执行。在执行过程中，需要用户提供input，此时需要前台生成表单交给用户填写。）
   ↓
Execution Feedback（执行过程反馈）
   ↓
Planner LLM（如果执行过程中有报错或者非正常返回，则需要Replan。如果顺利完成，则告知用户。）


## 3. 技术方案

- 原子服务能力定义: `project folder/atoms/*.json`。明确原子服务的能力，以及业务边界。
- 让推理模型理解原子服务，分析用户意图后，自行决断调用哪些服务来完成用户的意图。
- 推理模型会编排这些原子服务，并输出符合自定义协议的 IR。（DSL 文件：`project folder/core/plan.dsl.yaml`）
- Plan 校验：对生成的 Plan 做结构与语义校验后再进入 Human Approval / Executor。输入输出与校验规则见 `core/plan_validation.md`。

目前先把执行流程中的 Structured Plan 这步及以上做完，下边的步骤暂时不做。

## 4. 备注

1. 生成 plan 的时候可以约定「所有 step 的 output 自动进入一个共享上下文，后续 step 可按名引用」。
2. 如果把全部原子服务的定义给模型，以后会有 token 爆炸以及上下文爆炸的问题。
   - 2.1 按 package / category 做检索或分类，只把「可能相关的」atoms 子集给 Planner；或
   - 2.2 做两层：先选「用哪些 skill 包 / 哪几个 category」，再在这些里选具体 atoms 并编排。